{{$isEdit := .Team}}
<div id="modal-backdrop" class="fixed inset-0 bg-black bg-opacity-50 z-50" hx-target="this" hx-swap="outerHTML">
    <div id="modal" class="fixed inset-0 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl w-11/12 md:w-2/3 lg:w-1/2 max-w-2xl flex flex-col" hx-target="this" hx-swap="outerHTML">
            <form {{if $isEdit}}
                hx-put="/htmx/teams/{{.Team.ID}}"
            {{else}}
                hx-post="/htmx/teams/create"
            {{end}}
            hx-target="#team-list-container" hx-swap="outerHTML">
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 id="form-modal-title" class="text-lg font-bold text-slate-800">{{if $isEdit}}編輯團隊{{else}}新增團隊{{end}}</h3>
                    <button type="button" hx-get="/htmx/close" class="text-slate-500 hover:text-slate-800 text-2xl leading-none">&times;</button>
                </div>
                <div class="p-6 space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-slate-700">團隊名稱</label>
                        <input type="text" name="name" id="name" value="{{if $isEdit}}{{.Team.Name}}{{end}}" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" required>
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-slate-700">描述</label>
                        <textarea name="description" id="description" rows="3" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">{{if $isEdit}}{{.Team.Description}}{{end}}</textarea>
                    </div>
                    <div>
                        <label for="manager_id" class="block text-sm font-medium text-slate-700">團隊管理員</label>
                        <select name="manager_id" id="manager_id" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                            <option value="">-- 未指派 --</option>
                            {{range .Users}}
                            <option value="{{.ID}}" {{if and $isEdit (eq .ID $.Team.ManagerID)}}selected{{end}}>{{.Name}}</option>
                            {{end}}
                        </select>
                    </div>
                    <div class="border-t pt-4">
                        <h4 class="text-base font-semibold text-slate-800 mb-2">通知設定</h4>
                         <div>
                            <label for="primary_contact" class="block text-sm font-medium text-slate-700">主要聯絡人/管道</label>
                            <input type="text" name="primary_contact" id="primary_contact" value="{{if $isEdit}}{{.Team.NotificationSettings.PrimaryContact}}{{end}}" placeholder="輸入使用者或管道名稱" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                         <div>
                            <label for="escalation_contact" class="block text-sm font-medium text-slate-700">升級聯絡人/管道</label>
                            <input type="text" name="escalation_contact" id="escalation_contact" value="{{if $isEdit}}{{.Team.NotificationSettings.EscalationContact}}{{end}}" placeholder="輸入使用者或管道名稱" class="mt-1 block w-full rounded-lg border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm">
                        </div>
                    </div>
                </div>
                <div class="p-4 border-t bg-slate-50 rounded-b-xl flex justify-end space-x-2">
                    <button type="button" hx-get="/htmx/close" class="px-4 py-2 bg-slate-200 text-slate-800 rounded-lg hover:bg-slate-300 font-semibold transition-colors">取消</button>
                    <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold transition-colors">儲存</button>
                </div>
            </form>
        </div>
    </div>
</div>
