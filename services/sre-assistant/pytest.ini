# services/sre-assistant/pytest.ini
[pytest]
minversion = 7.0
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# 測試選項
addopts = 
    -ra
    -q
    --strict-markers
    --strict-config
    --cov=src/sre_assistant
    --cov-branch
    --cov-report=term-missing:skip-covered
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=70
    --maxfail=1
    --tb=short
    --disable-warnings

# 異步測試設定
asyncio_mode = auto

# 測試標記
markers =
    slow: 標記為慢速測試
    integration: 整合測試
    unit: 單元測試
    smoke: 冒煙測試
    api: API 測試
    workflow: 工作流程測試

# 環境變數
env = 
    ENVIRONMENT=test
    AUTH_PROVIDER=none
    DATABASE_URL=postgresql://postgres:postgres@localhost:5432/test_db
    REDIS_URL=redis://localhost:6379/1
    LOG_LEVEL=DEBUG

# 測試過濾
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning

# 測試輸出
console_output_style = progress
log_cli = false
log_cli_level = INFO