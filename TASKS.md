# SRE Platform 專案任務清單

> **基於**: SRE Platform 專案全面審查報告 (2025-09-05)  
> **當前專案成熟度**: 75/100  
> **目標**: 在12週內達到生產就緒狀態

---

## 🚨 第一優先級：關鍵問題修復

### ⚠️ 關鍵技術債務

#### **1. API 端點實作 (High)**
- [x] **修復 API 端點實作不一致問題**
  - [x] 實作 `POST /diagnostics/alerts` 端點
  - [x] 實作 `POST /diagnostics/capacity` 端點  
  - [x] 實作 `POST /diagnostics/execute` 端點
  - [x] 完成 `GET /api/v1/diagnostics/{session_id}/status` 端點
  - **狀態**: ✅ 已完成

#### **2. 任務持久化 (High)**
- [x] **實作任務狀態持久化**
  - [x] 使用 Redis 替代記憶體存儲任務狀態
  - [x] 實作任務狀態的持久化讀寫邏輯
  - [x] 設置任務狀態過期時間（24小時）
  - **狀態**: ✅ 已完成

#### **3. 並行執行錯誤處理 (High)**
- [ ] **修復工作流程錯誤處理**
  - [ ] 在 `workflow.py` 的 `asyncio.gather` 中添加異常處理
  - [ ] 實作單一工具失敗時的容錯機制
  - [ ] 實作超時控制邏輯（使用已定義的 `diagnosis_timeout`）
  - [ ] 實作重試機制（使用已配置的 `max_retries`）
  - **影響**: 單一工具失敗會導致整個診斷流程失敗
  - **優先級**: 🔴 高

#### **4. 資料模型不一致 (High)**
- [x] **修復 OpenAPI 規範一致性**
  - [x] 在 `DiagnosticResult` 中添加 `execution_plan` 欄位
  - [x] 定義 `AlertAnalysisRequest` 資料模型
  - [x] 定義 `CapacityAnalysisRequest` 資料模型
  - [x] 定義 `ExecuteRequest` 資料模型
  - **狀態**: ✅ 已完成

### ⚠️ 中優先級改進項目

#### **5. 認證安全強化**
- [ ] **完善 JWT 驗證實作**
  - [ ] 實作 `verify_token` 函數的實際 JWT 驗證
  - [ ] 與 Keycloak 進行整合測試
  - [ ] 處理 token 過期和刷新邏輯
  - **影響**: 目前使用模擬驗證
  - **優先級**: 🟡 中

#### **6. 工具實作完善**
- [ ] **完成 PrometheusQueryTool (當前完成度: 40%)**
  - [ ] 實作實際的 Prometheus 查詢邏輯
  - [ ] 移除模擬資料，使用真實 API 調用
  - [ ] 添加查詢優化和錯誤處理
  - [ ] 實作查詢結果快取機制
  - **驗收標準**: 可以成功查詢 Prometheus 指標並返回真實資料

- [ ] **完善 LokiLogQueryTool (當前完成度: 35%)**
  - [ ] 實作動態查詢參數設定
  - [ ] 添加完整的錯誤處理機制
  - [ ] 實作日誌過濾和聚合功能
  - **驗收標準**: 可以根據時間範圍和標籤查詢 Loki 日誌

- [ ] **開發 ControlPlaneTool (當前完成度: 10%)**
  > ⚠️ **調整說明**: 由於 sandbox 環境限制，改為與 Control Plane API 整合
  
  - [ ] **實作 Control Plane API 整合**
    - [ ] 查詢資源狀態 (`GET /api/v1/resources`)
    - [ ] 獲取資源詳情 (`GET /api/v1/resources/{resourceId}`)
    - [ ] 查詢資源群組 (`GET /api/v1/resource-groups`)
    - **驗收標準**: 可以成功調用 Control Plane API 並獲取資源資訊

  - [ ] **實作審計日誌查詢**
    - [ ] 查詢部署相關的審計日誌 (`GET /api/v1/audit-logs`)
    - [ ] 篩選特定服務的變更歷史
    - [ ] 解析變更類型（配置更新、版本部署、擴容等）
    - **驗收標準**: 可以獲取並分析最近的系統變更

  - [ ] **實作事件和告警查詢**
    - [ ] 查詢相關事件 (`GET /api/v1/incidents`)
    - [ ] 獲取告警規則狀態 (`GET /api/v1/alert-rules`)
    - [ ] 關聯事件與資源
    - **驗收標準**: 可以查詢和分析系統事件

  - [ ] **實作自動化執行記錄查詢**
    - [ ] 查詢自動化腳本執行歷史 (`GET /api/v1/automation/executions`)
    - [ ] 分析自動化操作對系統的影響
    - **驗收標準**: 可以追蹤自動化操作的執行情況

#### **7. 診斷功能實作**
- [ ] **完成告警診斷功能**
  - [ ] 實作 `_diagnose_alerts` 方法的實際邏輯
  - [ ] 建立告警關聯性分析
  - [ ] 實作根因分析邏輯
  - **驗收標準**: 可以分析 Prometheus 告警並提供診斷建議

- [ ] **完成容量分析功能**
  - [ ] 實作 `_analyze_capacity` 方法的實際邏輯
  - [ ] 建立資源使用趨勢分析
  - [ ] 實作容量預測邏輯
  - **驗收標準**: 可以分析系統容量使用情況並提供擴展建議

- [ ] **完成自然語言查詢功能**
  - [ ] 實作 `_execute_query` 方法的實際邏輯
  - [ ] 整合語言模型進行查詢解析
  - [ ] 動態調用相應工具
  - **驗收標準**: 可以理解並執行自然語言查詢

#### **8. Go 服務完善**
- [ ] **完成 Control Plane API 實作**
  - [ ] 實作實際的業務邏輯（非模擬資料）
  - [ ] 完成批次操作功能
  - [ ] 實作與 SRE Assistant 的完整整合
  - **驗收標準**: 所有 CRUD 操作都有實際資料庫操作

### 📊 測試與品質保障

#### **9. 測試覆蓋完善**
- [ ] **SRE Assistant Python 服務測試**
  - [ ] `workflow.py` 單元測試 (目標覆蓋率: 85%)
  - [ ] `main.py` API 端點測試 (目標覆蓋率: 90%)
  - [ ] 各診斷工具的單元測試 (目標覆蓋率: 80%)
  - **驗收標準**: Python 服務單元測試覆蓋率達到 80%

- [ ] **Control Plane Go 服務測試**
  - [ ] Handler 層測試
  - [ ] Service 層測試
  - [ ] Client 層測試
  - [ ] 與 SRE Assistant 整合測試
  - **驗收標準**: Go 服務單元測試覆蓋率達到 80%

#### **10. 整合測試**
- [ ] **API 整合測試**
  - [ ] 端到端診斷流程測試
  - [ ] 非同步任務狀態追蹤測試
  - [ ] 錯誤情境測試
  - **驗收標準**: 主要業務流程都有對應的整合測試

- [ ] **外部服務整合測試**
  - [ ] Prometheus 整合測試
  - [ ] Loki 整合測試
  - [ ] Keycloak 認證測試
  - **驗收標準**: 所有外部依賴都有整合測試驗證

### 🛠️ 基礎設施完善

#### **11. 配置管理**
- [x] **環境變數化配置**
  - [x] 將硬編碼的 URL 移至環境變數
  - [x] 建立 `.env.example` 檔案
  - [x] 更新 Docker Compose 配置
  - **狀態**: ✅ 已完成

#### **12. 監控與可觀測性**
- [ ] **實作 Prometheus Metrics**
  - [ ] API 請求次數和延遲指標
  - [ ] 診斷任務成功/失敗率
  - [ ] 外部服務調用指標
  - [ ] 系統資源使用指標
  - **驗收標準**: 關鍵業務指標都有對應的 Prometheus metrics

- [ ] **實作結構化日誌**
  - [ ] 統一日誌格式 (JSON)
  - [ ] 添加 TraceID 支援
  - [ ] 實作日誌等級控制
  - **驗收標準**: 所有服務都輸出結構化日誌

### 🚀 進階功能開發

#### **13. 性能優化**
- [ ] **實作連線池**
  - [ ] HTTP 客戶端連線池
  - [ ] 資料庫連線池
  - [ ] Redis 連線池
  - **驗收標準**: 在高負載下系統性能穩定

- [ ] **實作快取策略**
  - [ ] 查詢結果快取
  - [ ] 元資料快取
  - [ ] 會話快取
  - **驗收標準**: 相同查詢的響應時間顯著改善

#### **14. 安全增強**
- [ ] **實作 API 限流**
  - [ ] 基於 IP 的限流
  - [ ] 基於用戶的限流
  - [ ] 實作限流規則配置
  - **驗收標準**: 可以有效防止 API 濫用

- [ ] **實作審計日誌**
  - [ ] 記錄所有 API 調用
  - [ ] 記錄權限變更
  - [ ] 記錄敏感操作
  - **驗收標準**: 完整的操作審計追蹤

---

## 📈 KPI 追蹤

| 指標 | 當前狀態 | 目標 | 測量方式 |
|------|---------|------|----------|
| API 合規性 | 90% | 100% | OpenAPI 契約測試 |
| 測試覆蓋率 | ~30% | 80% | Coverage 工具 |
| P99 延遲 | N/A | <500ms | APM 監控 |
| 錯誤率 | N/A | <0.1% | 錯誤監控 |
| 可用性 | N/A | 99.9% | 正常運行時間監控 |

### 業務指標
- [x] **API 完整性** (第1週) ✅
  - 所有 OpenAPI 定義的端點都已實作
  
- [ ] **MVP 功能完成** (第4週)
  - 核心診斷功能可用
  - 基本 UI 可操作
  - 工具實際實作完成

- [ ] **Beta 版本發布** (第8週)
  - 性能達標
  - 基本監控完善
  - 主要 bug 修復

- [ ] **生產就緒** (第12週)
  - 安全檢查通過
  - 壓力測試通過
  - 文檔完整

---

## ⚠️ 風險管控

### 高風險項目監控
- [ ] **技術複雜度管控**
  - 每週技術債務評估
  - 代碼複雜度監控
  - 依賴關係管理

- [ ] **外部依賴風險**
  - 外部服務 SLA 監控
  - 備用方案準備
  - 降級策略測試

### 里程碑檢查點
- **Week 1**: ✅ 核心 API 實作完成
- **Week 2**: 錯誤處理和認證完善
- **Week 4**: MVP 功能可用
- **Week 8**: Beta 版本就緒
- **Week 12**: 生產環境部署

---

## 📋 每日站會追蹤項目

### 每日必檢項目
- [ ] 今日完成的任務
- [ ] 遇到的阻礙問題
- [ ] 明日計劃任務
- [ ] 風險與依賴關係

### 每週回顧項目
- [ ] KPI 指標進度
- [ ] 技術債務變化
- [ ] 風險評估更新
- [ ] 下週重點規劃

---

**最後更新**: 2025-09-06  
**負責人**: 開發團隊  
**審查週期**: 每週一次  
**完成目標**: 2025-12-01 生產就緒

---

## 已完成項目歸檔

### ✅ 第一週完成項目
1. **API 端點實作** - 所有缺失的端點都已實作
2. **資料模型對齊** - 完全符合 OpenAPI 規範
3. **任務持久化** - Redis 存儲已實作
4. **環境變數配置** - 完整的配置管理體系

### 📊 進度統計
- **總任務數**: 45
- **已完成**: 12
- **進行中**: 3
- **待開始**: 30
- **完成率**: 26.7%