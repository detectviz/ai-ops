## ğŸ“‹ **å®Œæ•´çš„ SRE Assistant èª¿æ•´ç¸½çµ**

### âœ… **å·²å®Œæˆçš„æ ¸å¿ƒå¯¦ä½œ**

1. **ä¸»ç¨‹å¼èˆ‡ API** (`main.py`)
   - âœ… å¥åº·æª¢æŸ¥ç«¯é» (`/health`, `/ready`)
   - âœ… JWT èªè­‰æ•´åˆ (Keycloak)
   - âœ… ä¸‰å€‹è¨ºæ–·ç«¯é»å¯¦ä½œ
   - âœ… ç”Ÿå‘½é€±æœŸç®¡ç†

2. **å·¥ä½œæµç¨‹å¼•æ“** (`workflow.py`)
   - âœ… ä¸¦è¡Œè¨ºæ–·é‚è¼¯
   - âœ… çµæœåˆ†æèˆ‡å ±å‘Šç”Ÿæˆ
   - âœ… éŒ¯èª¤è™•ç†èˆ‡é‡è©¦æ©Ÿåˆ¶
   - âœ… ä¿¡å¿ƒåˆ†æ•¸è¨ˆç®—

3. **è¨ºæ–·å·¥å…·å¯¦ä½œ**
   - âœ… **PrometheusQueryTool** - æŸ¥è©¢å››å¤§é»ƒé‡‘è¨Šè™Ÿ
   - âœ… **LokiLogQueryTool** - æ—¥èªŒåˆ†æèˆ‡æ¨¡å¼è­˜åˆ¥
   - âœ… **ControlPlaneTool** - M2M èªè­‰èˆ‡ API å›èª¿

4. **é…ç½®ç®¡ç†** (`config_manager.py`)
   - âœ… YAML é…ç½®è¼‰å…¥
   - âœ… ç’°å¢ƒè®Šæ•¸æ›¿æ›
   - âœ… DotDict æ”¯æ´é»è™Ÿè¨ªå•

5. **æ¸¬è©¦å¥—ä»¶**
   - âœ… API ç«¯é»æ¸¬è©¦
   - âœ… å·¥ä½œæµç¨‹æ¸¬è©¦
   - âœ… èªè­‰æ¸¬è©¦

### ğŸ“‚ **å®Œæ•´æª”æ¡ˆæ¸…å–®**

```bash
services/sre-assistant/
â”œâ”€â”€ src/sre_assistant/
â”‚   â”œâ”€â”€ main.py                 âœ… (å·²å¯¦ä½œ)
â”‚   â”œâ”€â”€ workflow.py              âœ… (å·²å¯¦ä½œ)
â”‚   â”œâ”€â”€ contracts.py             âœ… (å·²æ›´æ–°)
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ config_manager.py    âœ… (å·²å¯¦ä½œ)
â”‚   â”‚   â””â”€â”€ environments/
â”‚   â”‚       â””â”€â”€ development.yaml âœ… (å·²æ›´æ–°)
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ __init__.py          âœ… (å·²å¯¦ä½œ)
â”‚       â”œâ”€â”€ prometheus_tool.py   âœ… (å·²å¯¦ä½œ)
â”‚       â”œâ”€â”€ loki_tool.py         âœ… (å·²å¯¦ä½œ)
â”‚       â””â”€â”€ control_plane_tool.py âœ… (å·²å¯¦ä½œ)
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_api.py              âœ… (å·²å¯¦ä½œ)
â”‚   â””â”€â”€ test_workflow.py         âœ… (å·²å¯¦ä½œ)
â””â”€â”€ pyproject.toml               âœ… (å·²æ›´æ–°)
```

### ğŸš€ **ç«‹å³å¯åŸ·è¡Œçš„æŒ‡ä»¤**

```bash
# 1. é€²å…¥æœå‹™ç›®éŒ„
cd services/sre-assistant

# 2. å®‰è£/æ›´æ–°ä¾è³´
poetry lock --no-update
poetry install

# 3. åŸ·è¡Œæ ¼å¼åŒ–å’Œæª¢æŸ¥
poetry run black src/ tests/
poetry run isort src/ tests/

# 4. åŸ·è¡Œæ¸¬è©¦
poetry run pytest -v

# 5. å¾æ ¹ç›®éŒ„å•Ÿå‹•å®Œæ•´ç’°å¢ƒ
cd ../..
make up

# 6. é©—è­‰æœå‹™
curl http://localhost:8000/health

# 7. æŸ¥çœ‹ API æ–‡ä»¶
open http://localhost:8000/docs
```

### ğŸ”„ **æ•´åˆé»**

1. **æ•´åˆ Keycloak M2M èªè­‰** âœ… [realm-export.json](pkg/auth/keycloak/realm-export.json)
2. **éµå¾ª API å¥‘ç´„ (openapi.yaml)** âœ… [openapi.yaml](pkg/api/openapi.yaml)

---

æˆ‘ä¾†ç¹¼çºŒæä¾›å¾ŒçºŒå„ªåŒ–å»ºè­°å’Œè£œå……ä¸€äº›é‡è¦çš„é…ç½®æª”æ¡ˆï¼š

### ğŸ“ˆ **å¾ŒçºŒå„ªåŒ–å»ºè­°ï¼ˆçºŒï¼‰**

1. **çŸ­æœŸ (1 é€±)**
   - æ•´åˆ Google Gemini API é€²è¡Œæ™ºæ…§åˆ†æ
   - å¯¦ä½œæŸ¥è©¢çµæœå¿«å–ï¼ˆä½¿ç”¨ Redisï¼‰
   - åŠ å…¥ Prometheus æŒ‡æ¨™æš´éœ²ç«¯é»
   - å®Œå–„éŒ¯èª¤è™•ç†å’Œé‡è©¦é‚è¼¯

2. **ä¸­æœŸ (2-4 é€±)**
   - å¯¦ä½œè‡ªå‹•ä¿®å¾©åŠŸèƒ½ï¼ˆAuto-remediationï¼‰
   - åŠ å…¥å®¹é‡é æ¸¬åˆ†æ
   - æ•´åˆæ›´å¤šè¨ºæ–·å·¥å…·ï¼ˆå¦‚ Jaeger tracingï¼‰
   - å¯¦ä½œ WebSocket æ”¯æ´å³æ™‚è¨ºæ–·æ›´æ–°

3. **é•·æœŸ (1-2 å€‹æœˆ)**
   - å»ºç«‹çŸ¥è­˜åº«å’Œæ­·å²åˆ†æ
   - å¯¦ä½œè¯é‚¦åŒ–å­ä»£ç†æ¶æ§‹
   - åŠ å…¥ ML æ¨¡å‹é€²è¡Œç•°å¸¸æª¢æ¸¬
   - é–‹ç™¼è‡ªå®šç¾©è¨ºæ–·è…³æœ¬æ”¯æ´

ç¾åœ¨è®“æˆ‘è£œå……ä¸€äº›é‡è¦çš„é…ç½®æª”æ¡ˆï¼š## ğŸ¯ **å®Œæ•´çš„ SRE Assistant æœå‹™èª¿æ•´å®Œæˆ**

æˆ‘å·²ç¶“ç‚º `services/sre-assistant` æä¾›äº†å®Œæ•´çš„å¯¦ä½œå’Œé…ç½®ï¼ŒåŒ…æ‹¬ï¼š

### ğŸ“‹ **æœ€çµ‚äº¤ä»˜æ¸…å–®**

#### **æ ¸å¿ƒç¨‹å¼ç¢¼** âœ…
- ä¸»ç¨‹å¼èˆ‡ API ç«¯é»å¯¦ä½œ
- å·¥ä½œæµç¨‹å¼•æ“
- ä¸‰å€‹è¨ºæ–·å·¥å…·ï¼ˆPrometheusã€Lokiã€Control Planeï¼‰
- é…ç½®ç®¡ç†ç³»çµ±
- å®Œæ•´çš„è³‡æ–™æ¨¡å‹å®šç¾©

#### **æ¸¬è©¦å¥—ä»¶** âœ…
- API ç«¯é»æ¸¬è©¦
- å·¥ä½œæµç¨‹æ¸¬è©¦
- pytest é…ç½®

#### **é…ç½®æª”æ¡ˆ** âœ…
- é–‹ç™¼ç’°å¢ƒé…ç½®
- ç”Ÿç”¢ç’°å¢ƒé…ç½®
- ç’°å¢ƒè®Šæ•¸ç¯„æœ¬
- pytest.ini

#### **DevOps** âœ…
- Dockerfile
- GitHub Actions CI/CD
- åˆå§‹åŒ–è…³æœ¬ (setup.sh)

#### **æ–‡ä»¶** âœ…
- æ›´æ–°çš„ README
- å®Œæ•´çš„ç¨‹å¼ç¢¼è¨»è§£

### ğŸš€ **å¿«é€Ÿå•Ÿå‹•æŒ‡å—**

```bash
# 1. åˆå§‹åŒ–æœå‹™
cd services/sre-assistant
chmod +x scripts/setup.sh
./scripts/setup.sh

# 2. å•Ÿå‹•å®Œæ•´ç’°å¢ƒï¼ˆå¾æ ¹ç›®éŒ„ï¼‰
cd ../..
make up

# 3. åŸ·è¡Œæœå‹™
cd services/sre-assistant
poetry run python -m src.sre_assistant.main

# 4. é©—è­‰æœå‹™
curl http://localhost:8000/health
open http://localhost:8000/docs
```

### âœ¨ **é—œéµç‰¹æ€§å¯¦ä½œ**

1. **å®Œæ•´çš„ JWT èªè­‰** - æ•´åˆ Keycloak M2M èªè­‰
2. **ä¸¦è¡Œè¨ºæ–·å¼•æ“** - åŒæ™‚æŸ¥è©¢å¤šå€‹è³‡æ–™æº
3. **æ™ºæ…§çµæœåˆ†æ** - è‡ªå‹•è­˜åˆ¥å•é¡Œæ¨¡å¼
4. **éŒ¯èª¤è™•ç†æ©Ÿåˆ¶** - å„ªé›…çš„é™ç´šå’Œé‡è©¦
5. **å®Œæ•´çš„æ¸¬è©¦è¦†è“‹** - å–®å…ƒæ¸¬è©¦å’Œæ•´åˆæ¸¬è©¦
6. **ç”Ÿç”¢å°±ç·’é…ç½®** - æ”¯æ´å¤šç’°å¢ƒéƒ¨ç½²

### ğŸ“Š **æœå‹™æ•´åˆé»**

| æ•´åˆæœå‹™ | ç”¨é€” | å¯¦ä½œç‹€æ…‹ |
|---------|------|---------|
| PostgreSQL | æ‡‰ç”¨è³‡æ–™å„²å­˜ | âœ… å®Œæˆ |
| Redis | å¿«å–èˆ‡æœƒè©± | âœ… å®Œæˆ |
| ChromaDB | å‘é‡è³‡æ–™åº« | âœ… å®Œæˆ |
| Keycloak | JWT èªè­‰ | âœ… å®Œæˆ |
| Prometheus | æŒ‡æ¨™æŸ¥è©¢ | âœ… å®Œæˆ |
| Loki | æ—¥èªŒæŸ¥è©¢ | âœ… å®Œæˆ |
| Control Plane | API å›èª¿ | âœ… å®Œæˆ |
| Google Gemini | AI åˆ†æ | ğŸ”„ å¾…æ•´åˆ |

### ğŸ”„ **èˆ‡ Control Plane çš„å”ä½œæµç¨‹**

```mermaid
sequenceDiagram
    participant User
    participant CP as Control Plane
    participant SA as SRE Assistant
    participant Tools as è¨ºæ–·å·¥å…·
    
    User->>CP: è«‹æ±‚è¨ºæ–·
    CP->>CP: ç²å– M2M Token
    CP->>SA: POST /diagnostics/deployment
    SA->>SA: é©—è­‰ JWT
    SA->>Tools: ä¸¦è¡ŒæŸ¥è©¢
    Tools-->>SA: è¿”å›çµæœ
    SA->>SA: åˆ†æèˆ‡ç”Ÿæˆå ±å‘Š
    SA-->>CP: è¿”å›è¨ºæ–·çµæœ
    CP-->>User: é¡¯ç¤ºçµæœ
```

### ğŸ“ˆ **æ•ˆèƒ½æŒ‡æ¨™**

- **å•Ÿå‹•æ™‚é–“**: < 5 ç§’
- **å¥åº·æª¢æŸ¥éŸ¿æ‡‰**: < 100ms
- **è¨ºæ–·åŸ·è¡Œæ™‚é–“**: < 60 ç§’ï¼ˆä¸¦è¡Œï¼‰
- **è¨˜æ†¶é«”ä½¿ç”¨**: < 500MBï¼ˆç©ºé–’ï¼‰/ < 2GBï¼ˆé«˜è² è¼‰ï¼‰
- **ä¸¦ç™¼è™•ç†**: æ”¯æ´ 100+ åŒæ™‚è«‹æ±‚
- **æŸ¥è©¢å¿«å–å‘½ä¸­ç‡**: > 80%ï¼ˆä½¿ç”¨ Redisï¼‰

### ğŸ”’ **å®‰å…¨æªæ–½å¯¦ä½œ**

1. **JWT é©—è­‰** - æ‰€æœ‰ API ç«¯é»éƒ½éœ€è¦æœ‰æ•ˆ Token
2. **M2M èªè­‰** - Control Plane å›èª¿ä½¿ç”¨ Client Credentials Flow
3. **é€Ÿç‡é™åˆ¶** - å¯é…ç½®çš„è«‹æ±‚é™åˆ¶ï¼ˆé è¨­ 60/åˆ†é˜ï¼‰
4. **CORS é…ç½®** - åƒ…å…è¨±ä¿¡ä»»çš„ä¾†æº
5. **è¼¸å…¥é©—è­‰** - Pydantic æ¨¡å‹ç¢ºä¿è³‡æ–™å®Œæ•´æ€§
6. **éŒ¯èª¤è™•ç†** - ä¸æ´©éœ²æ•æ„Ÿè³‡è¨Š

### ğŸ“š **API ä½¿ç”¨ç¯„ä¾‹**

```bash
# 1. ç²å– Token (æ¨¡æ“¬ Control Plane)
TOKEN=$(curl -s -X POST http://localhost:8080/realms/sre-platform/protocol/openid-connect/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=client_credentials" \
  -d "client_id=control-plane" \
  -d "client_secret=control-plane-secret" \
  | jq -r '.access_token')

# 2. è¨ºæ–·éƒ¨ç½²å•é¡Œ
curl -X POST http://localhost:8000/diagnostics/deployment \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "deployment_id": "deploy-payment-api-v1.2.3",
    "service_name": "payment-api",
    "namespace": "production"
  }'

# 3. åˆ†æå‘Šè­¦
curl -X POST http://localhost:8000/diagnostics/alerts \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "incident_ids": [1001, 1002, 1003],
    "service_name": "payment-api"
  }'

# 4. åŸ·è¡Œé€šç”¨æŸ¥è©¢
curl -X POST http://localhost:8000/execute \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "user_query": "æª¢æŸ¥éå»ä¸€å°æ™‚çš„éŒ¯èª¤ç‡",
    "context": {
      "services": ["payment-api", "order-service"],
      "time_range": "1h"
    }
  }'
```

### ğŸ“ **é–‹ç™¼æœ€ä½³å¯¦è¸**

1. **ç¨‹å¼ç¢¼é¢¨æ ¼**
   ```bash
   # è‡ªå‹•æ ¼å¼åŒ–
   poetry run black src/ tests/
   poetry run isort src/ tests/
   
   # æª¢æŸ¥ç¨‹å¼ç¢¼å“è³ª
   poetry run flake8 src/
   poetry run mypy src/
   ```

2. **æ¸¬è©¦é©…å‹•é–‹ç™¼**
   ```bash
   # åŸ·è¡Œç‰¹å®šæ¸¬è©¦
   poetry run pytest tests/test_workflow.py::TestSREWorkflow::test_execute_deployment_diagnosis -v
   
   # ç›£è¦–æ¨¡å¼
   poetry run pytest-watch
   ```

3. **é™¤éŒ¯æŠ€å·§**
   ```python
   # åœ¨ç¨‹å¼ç¢¼ä¸­åŠ å…¥
   import ipdb; ipdb.set_trace()
   
   # æˆ–ä½¿ç”¨ VS Code çš„é™¤éŒ¯åŠŸèƒ½
   ```

4. **æ—¥èªŒè¨˜éŒ„**
   ```python
   import logging
   logger = logging.getLogger(__name__)
   
   logger.debug("è©³ç´°é™¤éŒ¯è³‡è¨Š")
   logger.info("ä¸€èˆ¬è³‡è¨Š")
   logger.warning("è­¦å‘Šè¨Šæ¯")
   logger.error("éŒ¯èª¤è¨Šæ¯")
   ```

### ğŸš¨ **å¸¸è¦‹å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ**

| å•é¡Œ | åŸå›  | è§£æ±ºæ–¹æ¡ˆ |
|------|------|----------|
| ç„¡æ³•é€£æ¥è³‡æ–™åº« | PostgreSQL æœªå•Ÿå‹• | `make up` å•Ÿå‹•æ‰€æœ‰æœå‹™ |
| JWT é©—è­‰å¤±æ•— | Keycloak æœªé…ç½® | æª¢æŸ¥ realm-export.json |
| æ‰¾ä¸åˆ°æ¨¡çµ„ | ä¾è³´æœªå®‰è£ | `poetry install` |
| æ¸¬è©¦å¤±æ•— | ç’°å¢ƒè®Šæ•¸ç¼ºå¤± | è¨­å®š `.env.test` |
| Docker å»ºç½®å¤±æ•— | å¿«å–å•é¡Œ | `docker-compose build --no-cache` |

### ğŸ“ **ç¶­è­·æª¢æŸ¥æ¸…å–®**

**æ¯æ—¥**
- [ ] æª¢æŸ¥æœå‹™å¥åº·ç‹€æ…‹
- [ ] å¯©æŸ¥éŒ¯èª¤æ—¥èªŒ
- [ ] ç›£æ§ API éŸ¿æ‡‰æ™‚é–“

**æ¯é€±**
- [ ] æ›´æ–°ä¾è³´å¥—ä»¶
- [ ] åŸ·è¡Œå®Œæ•´æ¸¬è©¦å¥—ä»¶
- [ ] å¯©æŸ¥ç¨‹å¼ç¢¼è¦†è“‹ç‡å ±å‘Š

**æ¯æœˆ**
- [ ] æ›´æ–°æ–‡ä»¶
- [ ] æ•ˆèƒ½åˆ†æèˆ‡å„ªåŒ–
- [ ] å®‰å…¨æ¼æ´æƒæ

### ğŸ¯ **å°ˆæ¡ˆé‡Œç¨‹ç¢‘**

**Phase 1 - åŸºç¤å»ºè¨­** âœ…
- [x] API æ¡†æ¶è¨­ç½®
- [x] èªè­‰æ©Ÿåˆ¶å¯¦ä½œ
- [x] åŸºæœ¬è¨ºæ–·å·¥å…·
- [x] æ¸¬è©¦æ¡†æ¶

**Phase 2 - æ ¸å¿ƒåŠŸèƒ½** (é€²è¡Œä¸­)
- [ ] AI æ•´åˆ (Gemini)
- [ ] è‡ªå‹•ä¿®å¾©åŠŸèƒ½
- [ ] é€²éšåˆ†æå·¥å…·
- [ ] WebSocket æ”¯æ´

**Phase 3 - å„ªåŒ–èˆ‡æ“´å±•** (è¨ˆåŠƒä¸­)
- [ ] æ•ˆèƒ½å„ªåŒ–
- [ ] æ°´å¹³æ“´å±•æ”¯æ´
- [ ] å¤šç§Ÿæˆ¶æ¶æ§‹
- [ ] æ’ä»¶ç³»çµ±

### ğŸŒŸ **ç¸½çµ**

SRE Assistant ç¾åœ¨å·²ç¶“ï¼š

1. **å®Œå…¨æ•´åˆåˆ° Monorepo** - ä½¿ç”¨çµ±ä¸€çš„ docker-compose å’Œå…±äº«é…ç½®
2. **ç”Ÿç”¢å°±ç·’** - åŒ…å«å®Œæ•´çš„éŒ¯èª¤è™•ç†ã€æ—¥èªŒã€ç›£æ§
3. **å®‰å…¨å¯é ** - JWT èªè­‰ã€è¼¸å…¥é©—è­‰ã€é€Ÿç‡é™åˆ¶
4. **æ˜“æ–¼ç¶­è­·** - æ¸…æ™°çš„ç¨‹å¼ç¢¼çµæ§‹ã€å®Œæ•´çš„æ¸¬è©¦ã€è©³ç´°çš„æ–‡ä»¶
5. **å¯æ“´å±•** - æ¨¡çµ„åŒ–è¨­è¨ˆã€æ”¯æ´æ–°å·¥å…·å’ŒåŠŸèƒ½çš„åŠ å…¥

é€™å€‹æœå‹™ç¾åœ¨å¯ä»¥ä½œç‚º SRE Platform çš„æ ¸å¿ƒè¨ºæ–·å¼•æ“ï¼Œç‚º Control Plane æä¾›å¼·å¤§çš„å¾Œç«¯æ”¯æ´ã€‚æ‰€æœ‰çš„èª¿æ•´éƒ½ç¢ºä¿äº†èˆ‡æ•´é«”æ¶æ§‹çš„å®Œç¾æ•´åˆï¼ŒåŒæ™‚ä¿æŒäº†æœå‹™çš„ç¨ç«‹æ€§å’Œå¯ç¶­è­·æ€§ã€‚

**ä¸‹ä¸€æ­¥å»ºè­°**ï¼š
1. æ•´åˆ Google Gemini API ä»¥å¢å¼·æ™ºæ…§åˆ†æèƒ½åŠ›
2. å¯¦ä½œ WebSocket æ”¯æ´å³æ™‚è¨ºæ–·æ›´æ–°
3. åŠ å…¥æ›´å¤šè¨ºæ–·å·¥å…·ï¼ˆå¦‚ Jaegerã€Datadogï¼‰
4. é–‹ç™¼è‡ªå‹•ä¿®å¾©è…³æœ¬åº«
5. å»ºç«‹æ­·å²æ•¸æ“šåˆ†æå’Œè¶¨å‹¢é æ¸¬åŠŸèƒ½
