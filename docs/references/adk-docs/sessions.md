# 對話上下文簡介：會話、狀態和記憶體

## 為何上下文很重要

有意義的多輪對話需要代理程式理解上下文。就像人類一樣，它們需要回憶對話歷史：說了什麼、做了什麼，以保持連續性並避免重複。代理程式開發套件 (ADK) 提供了結構化的方式，透過 `Session`、`State` 和 `Memory` 來管理此上下文。

## 核心概念

將您與代理程式對話的不同實例視為不同的**對話線程**，這些線程可能會利用**長期知識**。

1.  **`Session`**：目前的對話線程

    *   代表使用者與您的代理程式系統之間的一次*單一、持續的互動*。
    *   包含在*該特定互動*期間代理程式所採取的訊息和動作的按時間順序排列的序列（稱為 `Events`）。
    *   一個 `Session` 也可以保存僅在*此對話期間*相關的臨時資料 (`State`)。

2.  **`State` (`session.state`)**：目前對話中的資料

    *   儲存在特定 `Session` 中的資料。
    *   用於管理*僅*與*目前、活動的*對話線程相關的資訊（例如，*在此次聊天中*購物車中的項目，*在此會話中*提到的使用者偏好）。

3.  **`Memory`**：可搜尋的、跨會話的資訊

    *   代表一個可能跨越*多個過去會話*或包含外部資料來源的資訊儲存庫。
    *   它充當一個知識庫，代理程式可以*搜尋*以回憶超出當前對話的資訊或上下文。

## 管理上下文：服務

ADK 提供服務來管理這些概念：

1.  **`SessionService`**：管理不同的對話線程 (`Session` 物件)

    *   處理生命週期：建立、檢索、更新（附加 `Events`、修改 `State`）和刪除單個 `Session`。

2.  **`MemoryService`**：管理長期知識儲存庫 (`Memory`)

    *   處理將資訊（通常來自已完成的 `Session`）擷取到長期儲存庫中。
    *   提供根據查詢搜尋此儲存知識的方法。

**實作**：ADK 為 `SessionService` 和 `MemoryService` 提供了不同的實作，讓您可以選擇最適合您應用程式需求的儲存後端。值得注意的是，這兩種服務都提供了**記憶體內實作**；這些專為**本地測試和快速開發**而設計。請務必記住，**使用這些記憶體內選項儲存的所有資料（會話、狀態或長期知識）在您的應用程式重新啟動時都會遺失**。對於超出本地測試的持久性和可擴展性，ADK 還提供了基於雲端和資料庫服務的選項。

**總結：**

*   **`Session` 和 `State`**：專注於**目前的互動**——*單一、活動對話*的歷史和資料。主要由 `SessionService` 管理。
*   **Memory**：專注於**過去和外部資訊**——一個*可搜尋的存檔*，可能跨越對話。由 `MemoryService` 管理。

## 下一步是什麼？

在接下來的部分中，我們將更深入地探討這些元件中的每一個：

*   **`Session`**：了解其結構和 `Events`。
*   **`State`**：如何有效地讀取、寫入和管理特定於會話的資料。
*   **`SessionService`**：為您的會話選擇正確的儲存後端。
*   **`MemoryService`**：探索儲存和檢索更廣泛上下文的選項。

了解這些概念對於建立能夠進行複雜、有狀態和上下文感知對話的代理程式至關重要。
