# A2A 簡介

當您建構更複雜的代理系統時，您會發現單一代理通常是不夠的。您會想要建立可以協同解決問題的專門代理。 [**代理對代理 (A2A) 協定**](https://a2aprotocol.ai/) 是允許這些代理相互通訊的標準。

## 何時使用 A2A 與本地子代理

- **本地子代理：** 這些代理與您的主代理在*同一個應用程式處理程序*中執行。它們就像內部模組或函式庫，用於將您的程式碼組織成邏輯上可重複使用的元件。主代理與其本地子代理之間的通訊非常快速，因為它直接在記憶體中進行，沒有網路開銷。

- **遠端代理 (A2A)：** 這些是作為獨立服務執行的獨立代理，透過網路進行通訊。A2A 定義了此通訊的標準協定。

在以下情況下考慮使用 **A2A**：

- 您需要交談的代理是一個**獨立的、獨立的服務** (例如，一個專門的財務模型代理)。
- 該代理由**不同的團隊或組織**維護。
- 您需要連接以**不同程式語言或代理框架**撰寫的代理。
- 您希望在系統元件之間強制執行**強式、正式的合約** (A2A 協定)。

### 何時使用 A2A：具體範例

- **與第三方服務整合：** 您的主代理需要從外部金融資料提供者取得即時股價。此提供者透過與 A2A 相容的代理公開其資料。
- **微服務架構：** 您有一個大型系統，分解成較小的獨立服務 (例如，訂單處理代理、庫存管理代理、運送代理)。A2A 非常適合這些服務跨網路邊界相互通訊。
- **跨語言通訊：** 您的核心業務邏輯在 Python 代理中，但您有一個以 Java 撰寫的舊版系統或專門元件，您希望將其整合為代理。A2A 提供了標準化的通訊層。
- **正式的 API 強制執行：** 您正在建構一個平台，其中不同的團隊貢獻代理，您需要一個嚴格的合約來規範這些代理如何互動，以確保相容性和穩定性。

### 何時不使用 A2A：具體範例 (首選本地子代理)

- **內部程式碼組織：** 您正在將單一代理中的複雜任務分解為更小、更易於管理的功能或模組 (例如，一個在處理前清理輸入資料的 `DataValidator` 子代理)。為了效能和簡單性，最好將這些作為本地子代理處理。
- **效能關鍵的內部操作：** 子代理負責與主代理的執行緊密耦合的高頻率、低延遲操作 (例如，在同一個應用程式中處理資料流的 `RealTimeAnalytics` 子代理)。
- **共用記憶體/上下文：** 當子代理需要直接存取主代理的內部狀態或共用記憶體以提高效率時，A2A 的網路開銷和序列化/反序列化將會適得其反。
- **簡單的輔助函式：** 對於不需要獨立部署或複雜狀態管理的小型、可重複使用的邏輯片段，同一個代理中的簡單函式或類別比單獨的 A2A 代理更合適。

## ADK 中的 A2A 工作流程：簡化視圖

代理開發套件 (Agent Development Kit, ADK) 簡化了使用 A2A 協定建構和連接代理的過程。以下是其運作方式的簡單分解：

1. **讓代理可存取 (公開)：** 您從一個現有的 ADK 代理開始，您希望其他代理能夠與之互動。ADK 提供了一種簡單的方法來「公開」此代理，將其轉變為 **A2AServer**。此伺服器充當公共介面，允許其他代理透過網路向您的代理傳送請求。可以把它想像成是為您的代理設定一個網頁伺服器。

2. **連接到可存取的代理 (取用)：** 在一個單獨的代理中 (它可以在同一台機器或不同的機器上執行)，您將使用一個名為 `RemoteA2aAgent` 的特殊 ADK 元件。這個 `RemoteA2aAgent` 充當一個知道如何與您先前公開的 **A2AServer** 通訊的用戶端。它在幕後處理所有網路通訊、驗證和資料格式化的複雜性。

從開發人員的角度來看，一旦您設定了此連線，與遠端代理的互動就像與本地工具或函式互動一樣。ADK 抽離了網路層，使得分散式代理系統與本地系統一樣易於使用。

## 視覺化 A2A 工作流程

為了進一步闡明 A2A 工作流程，讓我們看看公開和取用代理的「之前和之後」，然後是組合系統。

### 公開代理

**公開之前：**
您的代理程式碼作為一個獨立的元件執行，但在這種情況下，您希望將其公開，以便其他遠端代理可以與您的代理互動。

```text
+-------------------+
| 您的代理程式碼    |
|   (獨立)          |
+-------------------+
```

**公開之後：**
您的代理程式碼與 `A2AServer` (一個 ADK 元件) 整合，使其可以透過網路供其他遠端代理存取。

```text
+-----------------+
|   A2A 伺服器    |
| (ADK 元件)      |<--------+
+-----------------+         |
        |                   |
        v                   |
+-------------------+       |
| 您的代理程式碼    |       |
| (現在可存取)      |       |
+-------------------+       |
                            |
                            | (網路通訊)
                            v
+-----------------------------+
|       遠端代理              |
|    (現在可以通訊)           |
+-----------------------------+
```

### 取用代理

**取用之前：**
您的代理 (在此上下文中稱為「根代理」) 是您正在開發的需要與遠端代理互動的應用程式。在取用之前，它缺乏直接的機制來執行此操作。

```text
+----------------------+         +-------------------------------------------------------------+
|      根代理          |         |                        遠端代理                             |
| (您現有的程式碼)     |         | (您希望根代理與之交談的外部服務)                            |
+----------------------+         +-------------------------------------------------------------+
```

**取用之後：**
您的根代理使用 `RemoteA2aAgent` (一個充當遠端代理用戶端代理的 ADK 元件) 來建立與遠端代理的通訊。

```text
+----------------------+         +-----------------------------------+
|      根代理          |         |         RemoteA2aAgent            |
| (您現有的程式碼)     |<------->|         (ADK 用戶端代理)          |
+----------------------+         |                                   |
                                 |  +-----------------------------+  |
                                 |  |         遠端代理            |  |
                                 |  |      (外部服務)             |  |
                                 |  +-----------------------------+  |
                                 +-----------------------------------+
      (現在透過 RemoteA2aAgent 與遠端代理交談)
```

### 最終系統 (組合視圖)

此圖顯示了取用和公開部分如何連接以形成一個完整的 A2A 系統。

```text
取用端：
+----------------------+         +-----------------------------------+
|      根代理          |         |         RemoteA2aAgent            |
| (您現有的程式碼)     |<------->|         (ADK 用戶端代理)          |
+----------------------+         |                                   |
                                 |  +-----------------------------+  |
                                 |  |         遠端代理            |  |
                                 |  |      (外部服務)             |  |
                                 |  +-----------------------------+  |
                                 +-----------------------------------+
                                                 |
                                                 | (網路通訊)
                                                 v
公開端：
                                               +-----------------+
                                               |   A2A 伺服器    |
                                               | (ADK 元件)      |
                                               +-----------------+
                                                       |
                                                       v
                                               +-------------------+
                                               | 您的代理程式碼    |
                                               | (公開的服務)      |
                                               +-------------------+
```

## 具體使用案例：客戶服務和產品目錄代理

讓我們考慮一個實際的例子：一個需要從一個獨立的 **產品目錄代理** 檢索產品資訊的 **客戶服務代理**。

### A2A 之前

最初，您的客戶服務代理可能沒有直接、標準化的方式來查詢產品目錄代理，特別是如果它是一個獨立的服務或由不同的團隊管理。

```text
+-------------------------+         +--------------------------+
| 客戶服務代理            |         |  產品目錄代理            |
| (需要產品資訊)          |         | (包含產品資料)           |
+-------------------------+         +--------------------------+
      (沒有直接、標準化的通訊)
```

### A2A 之後

透過使用 A2A 協定，產品目錄代理可以將其功能公開為 A2A 服務。然後，您的客戶服務代理可以使用 ADK 的 `RemoteA2aAgent` 輕鬆取用此服務。

```text
+-------------------------+         +-----------------------------------+
| 客戶服務代理            |         |         RemoteA2aAgent            |
| (您的根代理)            |<------->|         (ADK 用戶端代理)          |
+-------------------------+         |                                   |
                                    |  +-----------------------------+  |
                                    |  |     產品目錄代理            |  |
                                    |  |      (外部服務)             |  |
                                    |  +-----------------------------+  |
                                    +-----------------------------------+
                                                 |
                                                 | (網路通訊)
                                                 v
                                               +-----------------+
                                               |   A2A 伺服器    |
                                               | (ADK 元件)      |
                                               +-----------------+
                                                       |
                                                       v
                                               +------------------------+
                                               | 產品目錄代理           |
                                               | (公開的服務)           |
                                               +------------------------+
```

在此設定中，首先，需要透過 A2A 伺服器公開產品目錄代理。然後，客戶服務代理可以像使用工具一樣簡單地呼叫 `RemoteA2aAgent` 上的方法，ADK 會處理所有與產品目錄代理的底層通訊。這允許明確的關注點分離和專門代理的輕鬆整合。

## 後續步驟

現在您已經了解了 A2A 的「為什麼」，讓我們深入了解「如何」。

- **繼續下一個指南：**
  [快速入門：公開您的代理](a2a-quickstart-exposing.md)
