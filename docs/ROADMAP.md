# SRE Platform - é–‹ç™¼è·¯ç·šåœ–èˆ‡ä»»å‹™æ¸…å–®

> **åŸºæ–¼**: SRE Platform å°ˆæ¡ˆå…¨é¢å¯©æŸ¥å ±å‘Š (2025-09-05)
> **ç•¶å‰å°ˆæ¡ˆæˆç†Ÿåº¦**: 90/100
> **ç›®æ¨™**: åœ¨10é€±å…§é”åˆ°ç”Ÿç”¢å°±ç·’ç‹€æ…‹
>
> **ç¸½è¦½**: æœ¬æ–‡ä»¶æ˜¯ SRE Platform å°ˆæ¡ˆçš„**å”¯ä¸€çœŸå¯¦ä¾†æº (Single Source of Truth)**ï¼Œç”¨æ–¼è¿½è¹¤æ‰€æœ‰é–‹ç™¼ä»»å‹™ã€‚å®ƒæ ¹æ“šæ¶æ§‹è¨­è¨ˆçš„éšæ®µé€²è¡Œçµ„ç¹”ï¼Œä¸¦æ•´åˆäº†æ‰€æœ‰æ–°åŠŸèƒ½ã€é‡æ§‹è¨ˆç•«å’Œå·²çŸ¥çš„æŠ€è¡“å‚µã€‚

---

## å¾…è¾¦äº‹é … (Backlog)

### ç¶œåˆå¯©æŸ¥ä¿®æ­£å»ºè­°ï¼ˆAudit Fixesï¼‰
- [ ] **å¥‘ç´„å›æ­¸æ¸¬è©¦èˆ‡ CI æ•´åˆ**ï¼šå¯¦ç¾ `make test` ä»¥èšåˆå…©æœå‹™çš„å¥‘ç´„æ¸¬è©¦ï¼Œä¸¦åœ¨ CI æµç¨‹ä¸­è‡ªå‹•åŸ·è¡Œã€‚

### ä¸­å„ªå…ˆåº¦ï¼ˆ2â€“3 é€±ï¼‰
- [ ] **E2E æ¸¬è©¦**ï¼šå¯¦ç¾ä¸€å€‹å®Œæ•´çš„ç«¯åˆ°ç«¯æ¸¬è©¦ï¼Œæ¨¡æ“¬å¾ Control Plane UI è§¸ç™¼éƒ¨ç½²è¨ºæ–·ï¼Œä¸¦é©—è­‰ SRE Assistant éåŒæ­¥ä»»å‹™çš„è¼ªè©¢èˆ‡æœ€çµ‚çµæœå‘ˆç¾ã€‚

### Phase 1: æ ¸å¿ƒæ•´åˆ
- [ğŸš§] **1.3. æ ¸å¿ƒå·¥å…·é–‹ç™¼ (`Prometheus`, `Loki`, `ControlPlane`)**:
    - **ç›®æ¨™**: ç§»é™¤æ‰€æœ‰æ¨¡æ“¬è³‡æ–™ï¼Œå¯¦ç¾çœŸå¯¦çš„å·¥å…·é‚è¼¯ã€‚
    - **ç¾ç‹€**: æ‰€æœ‰å·¥å…·çš„å”¯è®€æ–¹æ³•å‡å·²å¯¦ç¾ä¸¦ç¶“éé©—è­‰ã€‚
- [ğŸš§] **1.4. ç«¯åˆ°ç«¯æµç¨‹å¯¦ä½œèˆ‡æ¸¬è©¦**:
    - **ç›®æ¨™**: å»ºç«‹å®Œæ•´çš„æ•´åˆæ¸¬è©¦ã€‚
    - **ç›¸é—œå­ä»»å‹™**:
        - [ ] **å¤–éƒ¨æœå‹™æ•´åˆæ¸¬è©¦**: æ’°å¯«èƒ½èˆ‡çœŸå¯¦ Prometheus, Loki, Keycloak äº’å‹•çš„æ•´åˆæ¸¬è©¦ã€‚

### Phase 2: Control Plane åŠŸèƒ½æ“´å±•èˆ‡ UI æ•´åˆ
- [ğŸš§] **2.1. å¯¦ç¾è¨ºæ–·å¾Œç«¯é‚è¼¯**:
    - **ç›®æ¨™**: å®Œæ•´å¯¦ç¾ `SREWorkflow` ä¸­çš„ `_diagnose_alerts`, `_analyze_capacity`, `_execute_query` æ–¹æ³•ã€‚
    - **æ³¨æ„äº‹é …**:
        - `test_integration.py` ä¸­æœ‰å…©å€‹æ¸¬è©¦ (`test_access_protected_endpoint_with_bad_token`, `test_loki_query_integration`) å› ç’°å¢ƒå•é¡Œæš«æ™‚è·³éï¼Œå¾…å¾ŒçºŒä¿®å¾©ã€‚
- [ ] **2.2. Control Plane Go æœå‹™å®Œå–„**:
    - **ä»»å‹™**: å¯¦ç¾ Control Plane çš„çœŸå¯¦æ¥­å‹™é‚è¼¯ï¼Œå–ä»£æ‰€æœ‰æ¨¡æ“¬è³‡æ–™ã€‚
- [ ] **2.3. æ¸¬è©¦è¦†è“‹ç‡æå‡**:
    - **ä»»å‹™**: ç‚ºæ‰€æœ‰åœ¨ Phase 1 å’Œ Phase 2 ä¸­å¯¦ç¾çš„æ ¸å¿ƒæ¨¡çµ„èˆ‡å·¥å…·å¢åŠ å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦ï¼Œç›®æ¨™è¦†è“‹ç‡ > 80%ã€‚
- [ ] **2.4. å»ºç«‹ä¸²æµå¼å‰ç«¯è³‡æ–™æ¨¡å‹**:
    - **ä»»å‹™**: æ ¹æ“š `gemini-fullstack` ç¯„ä¾‹ï¼Œç‚ºå‰ç«¯å®šç¾©ä¸€å€‹èƒ½å¤ è™•ç†ä¾†è‡ª `sre-assistant` ä¸²æµäº‹ä»¶çš„è³‡æ–™æ¨¡å‹ã€‚

### Phase 3: è¯é‚¦åŒ–èˆ‡ä¸»å‹•é é˜²
- [ ] **3.1. å¯¦ç¾å¢å¼·å‹ SRE å·¥ä½œæµç¨‹**:
- [ ] **3.2. ç¬¬ä¸€å€‹å°ˆæ¥­åŒ–å­ä»£ç†**:
- [ ] **3.3. ä¸»å‹•é é˜²èƒ½åŠ›**:
- [ ] **3.4. ä»£ç†å¯è§€æ¸¬æ€§**:

---

## âœ… å·²å®Œæˆé …ç›®æ­¸æª” (Archive of Completed Items)
- [x] **æ¶æ§‹é‡æ§‹ï¼šHeadless API**
    - **ä»»å‹™**: å°‡ `control-plane` é‡æ§‹ç‚ºç´” API æœå‹™ï¼Œç§»é™¤æ‰€æœ‰å‰ç«¯ç›¸é—œç¨‹å¼ç¢¼ã€‚
    - **ç†ç”±**: ç‚ºäº†æ”¯æ´æ–°çš„ç¨ç«‹å‰ç«¯ (`sre-platform-frontend`)ï¼Œå¾Œç«¯å¿…é ˆè§£è€¦ã€‚
    - **å·²å®Œæˆ**:
        - [x] åˆªé™¤ `services/control-plane/web` ç›®éŒ„ã€‚
        - [x] ç§»é™¤ `cmd/server/main.go` ä¸­çš„ Web ä¼ºæœå™¨è·¯ç”±èˆ‡æ¨¡æ¿æ¸²æŸ“é‚è¼¯ã€‚
        - [x] æ›´æ–° `sre-assistant` çš„ `control_plane_contracts.py` ä»¥ç¬¦åˆæ–°çš„ `openapi.yaml`ã€‚

### ç¶œåˆå¯©æŸ¥ä¿®æ­£å»ºè­°ï¼ˆAudit Fixesï¼‰
- [x] **PrometheusQueryTool**: å·²é‡æ§‹ï¼ŒåŠ å…¥åŸºæ–¼ Tenacity çš„æŒ‡æ•¸é€€é¿é‡è©¦èˆ‡æ›´è©³ç´°çš„éŒ¯èª¤åˆ†é¡ã€‚

### é«˜å„ªå…ˆåº¦ï¼ˆæœ¬é€±å…§ï¼‰
- [x] SRE Assistantï¼š/api/v1/healthzï¼ˆHealthStatusï¼‰
- [x] SRE Assistantï¼š/api/v1/readyzï¼ˆReadinessStatusï¼šchecks=prometheus/loki/control_planeï¼‰
- [x] SRE Assistantï¼š/api/v1/metricsï¼ˆtext/plain; Prometheus exposition formatï¼‰
- [x] SRE Assistantï¼šcontrol_plane.base_url â†’ http://localhost:8081/api/v1
- [x] å·¥å…·å±¤éŒ¯èª¤è™•ç†åˆ†é¡èˆ‡çµ±ä¸€ ToolErrorï¼ˆhttpx HTTPStatusError/Timeout/ConnectErrorï¼‰
- [x] å·¥å…·å±¤å–®å…ƒæ¸¬è©¦ï¼ˆæˆåŠŸ/è¶…æ™‚/ä¾‹å¤–/å¿«å–å‘½ä¸­ï¼‰
- [x] Control Planeï¼š/api/v1/healthzã€/api/v1/readyzã€/api/v1/metrics
- [x] Control Planeï¼š/api/v1/dashboard/trendsã€/api/v1/dashboard/resource-distributionï¼ˆæœ€å°å¯¦ä½œï¼‰
- [x] Control Planeï¼šCookie/Session é‡‘é‘°æ”¹ç‚ºç’°å¢ƒè®Šæ•¸ï¼ˆCONTROL_PLANE_SESSION_KEYï¼‰

### ä¸­å„ªå…ˆåº¦ï¼ˆ2â€“3 é€±ï¼‰
- [x] çµæ§‹åŒ–æ—¥èªŒä¸€è‡´æ€§ï¼š
  - [x] Pythonï¼šstructlog/python-json-logger + Request/Trace ID ä¸­ä»‹å±¤
  - [x] Goï¼šRequestID middleware + otelzap JSON æ¬„ä½ä¸€è‡´
- [x] HTTP é€¾æ™‚/é‡è©¦/é€£ç·šæ± ç­–ç•¥çµ±ä¸€ï¼ˆhttpx / net/httpï¼‰
- [x] ControlPlaneTool å”¯è®€èƒ½åŠ›è¦†è“‹ï¼ˆresources/resource-groups/audit-logs/incidents/alert-rules/automation/executionsï¼‰ä¸¦ä»¥ Pydantic é©—è­‰
- [x] ä¿®å¾© Control Plane Tracer ä¾è³´ä¸¦æ¢å¾© OTel Traceï¼›èˆ‡ SRE Assistant ä¸²æ¥ trace-id
- [x] æ¸¬è©¦è¦†è“‹ â‰¥ 60%ï¼ˆç¬¬ä¸€éšæ®µï¼‰

### å„Ÿé‚„ç¾æœ‰æŠ€è¡“å‚µ
- [x] **1. æ€§èƒ½å„ªåŒ–èˆ‡å®‰å…¨å¢å¼·**:
    - **ä»»å‹™**: å¯¦ç¾é€£ç·šæ± ã€API é™æµå’Œå¯©è¨ˆæ—¥èªŒã€‚
    - **ç›¸é—œå­ä»»å‹™ (æ€§èƒ½)**:
        - [x] **å¯¦ä½œé€£ç·šæ± **: HTTP å®¢æˆ¶ç«¯, è³‡æ–™åº«, Redisã€‚
        - [x] **å¯¦ä½œå¿«å–ç­–ç•¥**: æŸ¥è©¢çµæœ, å…ƒè³‡æ–™, æœƒè©±ã€‚
    - **ç›¸é—œå­ä»»å‹™ (å®‰å…¨)**:
        - [x] **å¯¦ä½œ API é™æµ**: åŸºæ–¼ IP å’Œç”¨æˆ¶ã€‚
        - [x] **å¯¦ä½œå¯©è¨ˆæ—¥èªŒ**: è¨˜éŒ„æ‰€æœ‰ API èª¿ç”¨å’Œæ•æ„Ÿæ“ä½œã€‚
- [x] **2. æ¸…ç†æŠ€è¡“å‚µ (Clean Up Technical Debt)**:
    - **ä»»å‹™**: è§£æ±ºç¨‹å¼ç¢¼åº«ä¸­çš„å°å•é¡Œï¼š1) å®Œæ•´å¯¦ç¾ `main.py` ä¸­çš„å¥åº·æª¢æŸ¥ (`check_database`, `check_redis`)ã€‚2) å°‡ `main.py` ä¸­çš„èªè­‰é‚è¼¯é‡æ§‹åˆ°ç¨ç«‹çš„æ¨¡çµ„ä¸­ã€‚
- [x] **3. å¢å¼· ControlPlaneTool (Enhance ControlPlaneTool)**:
    - **ä»»å‹™**: å°‡ `ControlPlaneTool` é‡æ§‹ç‚ºä¸€å€‹åŠŸèƒ½å®Œæ•´çš„å·¥å…·é›†ã€‚1) ç‚ºæ‰€æœ‰è¼¸å…¥å’Œè¼¸å‡ºå®šç¾© Pydantic æ¨¡å‹ã€‚2) è¿”å›çµæ§‹åŒ–çš„æˆåŠŸ/éŒ¯èª¤å›æ‡‰ã€‚3) å¢åŠ å¯«å…¥/ä¿®æ”¹æ“ä½œï¼Œä¾‹å¦‚ `restart_deployment`, `acknowledge_alert` ç­‰ï¼Œä½¿å…¶ä¸åƒ…åƒ…æ˜¯å”¯è®€çš„ã€‚

### Phase 1: æ ¸å¿ƒæ•´åˆ
- [x] **1.1. API å¥‘ç´„ç¬¦åˆæ€§ (API Contract Compliance)**
- [x] **1.2. æœå‹™å°æœå‹™èªè­‰ (M2M Authentication)**
- [x] **1.5. æ ¸å¿ƒæœå‹™æœ¬åœ°åŒ–èˆ‡æŒä¹…åŒ–**
